---
layout:     post
title:      TCP中用到的定时器
category:   network
description: TCP为每条连接建立七个定时器
---


<div id="article_content" class="article_content clearfix">
            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css">
                                        <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css">
                <div class="htmledit_views" id="content_views">
                                            
<span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">TCP为每条连接建立七个定时器：<br>
&nbsp; &nbsp; &nbsp; &nbsp; 1、<span style="color:rgb(255,0,0);">连接建立定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">在发送SYN报文段建立一条新连接时启动。如果没有在75秒内收到响 应，连接建立将中止。当TCP实例将其状态从LISTEN更改为SYN_RECV的时侯就会使用这一计时器.服务端的TCP实例最初会等待一个ACK三秒钟.如果在这一段时间没有ACK到达，则认为该连接请求是过期的。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp;&nbsp;2、<span style="color:rgb(255,0,0);">重传定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">在TCP发送数据时设定.如果定时器已超时而对端的确认还未到达，TCP将重传数据.重传定时器的值(即TCP等待对端确认的时间)是动态计算的，取决于TCP为该
 连接测量的往返时间和该报文段已重传几次。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp;&nbsp;3、<span style="color:rgb(255,0,0);">延迟定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">在TCP收到必须被确认但无需马上发出确认的数据时设定.TCP等
 待时间200MS后发送确认响应.如果，在这200MS内，有数据要在该连接上发送，延迟的ACK响应就可随着数据一起发送回对端，称为稍带确认。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">4、<span style="color:rgb(255,0,0);">持续定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">在连接对端通告接收窗口为0，阻止TCP继续发送数据时设定.由于连接对端发送的窗口通告不可靠，允许TCP继续发送数据的后续窗口更新有可能丢失.因此，如果TCP有数据要发送，但对端通告接收窗口为0，则持续定时器启动，超时后向对端发送1字节的数据，判定对端接收窗口是否已打开.与重传定时器类似，持续定时器的值也是动态计算的，取决于连接的往返时间，在5秒到60秒之间取值。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp;5、<span style="color:rgb(255,0,0);">保活定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">在应用进程选取了插口的SO_KEEPALIVE选项时生效.如果连接的连续空闲时间超过2小时，保活定时器超时，向对端发送连接探测报文段，强迫对端响应.如果收到了期待的响应，TCP确定对端主机工作正常，在该连接再次空闲超过2小时之前，TCP不会再进行保活测试，.如果收到的是其它响应，TCP确定对端主要已重启.如果连纽若干次保活测试都未收到响应，TCP就假定对端主机已崩溃，尽管它无法区分是主机帮障还是连接故障。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">6、<span style="color:rgb(255,0,0);">FIN_WAIT-2定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">，当某个连接从FIN_WAIT-1状态变迁到FIN_WAIN_2状态，并且不能再接收任何数据时，FIN_WAIT_2定时器启动，设为10分钟，定时器超时后，重新设为75秒，第二次超时后连接被关闭，加入这个定时器的目的为了避免如果对端一直不发送FIN，某个连接会永远滞留在FIN_WAIT_2状态。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">&nbsp;7、<span style="color:rgb(255,0,0);">TIME_WAIT定时器</span></span><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">，一般也称为2MSL定时器.2MS指两倍MSL.当连接转移到TIME_WAIT状态，即连接主动关闭时，定时器启动.连接进入TIME_WAIT状态时，定时器设定为1分钟，超时后，TCP控制块和INTERNET
 PCB被删除，端口号可重新使用。</span><br style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;"><span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;">TCP包含两个定时器函数:一个函数每200MS调用一次(快速定时器);另一个函数每500MS调用一次.延迟定时器与其它6个定时器有所不同;如果某个连接上设定了延迟ACK定时器，那么下一次200MS定时器超时后，延迟的ACK必须被发送.其它的定时器每500MS递减一次，计数器减为0时，就触发相应的动作。</span>